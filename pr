
-- Who is blocking who
SELECT 
    r.session_id,
    r.blocking_session_id,
    r.status,
    r.command,
    t.text AS query_text
FROM sys.dm_exec_requests r
CROSS APPLY sys.dm_exec_sql_text(r.sql_handle) t
WHERE r.blocking_session_id <> 0;
