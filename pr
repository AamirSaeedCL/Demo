CREATE PROCEDURE [stg].[usp_Customer_Ingestion_CustomerOwnership]
AS
BEGIN
    SET NOCOUNT ON;

    BEGIN TRY
        BEGIN TRANSACTION;

        -- Update ownership details in the Customer table from staging table
        UPDATE C
        SET 
            C.Ownership = CO.Ownership,
            C.OwnershipDate = CO.OwnershipDate
        FROM dbo.Customer AS C
        INNER JOIN stg.CustomerOwnership AS CO 
            ON C.CustomerId = CO.CustomerId;

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        IF @@TRANCOUNT > 0
            ROLLBACK TRANSACTION;

        -- Simple error message
        PRINT 'An error occurred in usp_Customer_Ingestion_CustomerOwnership.';
        PRINT ERROR_MESSAGE();
    END CATCH
END;
