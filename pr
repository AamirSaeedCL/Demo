#Remove Lock on Storage resourceGroup
$lockid=Get-AzResourceLock |where ResourceGroupName -Match ${env:storageresourceGroup}
Remove-AzResourceLock -lockid $lockid.lockid -force

#Remove Lock on ADF resourceGroup
$lockid=Get-AzResourceLock |where ResourceGroupName -Match ${env:resourceGroup}
Remove-AzResourceLock -lockid $lockid.lockid -force

 
#stop triggers that are currently started
 $list =  Get-AzDataFactoryV2Trigger -ResourceGroupName ${env:resourceGroup} -DataFactoryName ${env:factoryName} | where RuntimeState -eq 'Started' | Select-Object -ExpandProperty Name
 $array = @($list)
    Foreach ($i in $array)

    {
    Write-Output "Trigger to disable & remove is $i"
    Stop-AzDataFactoryV2Trigger -ResourceGroupName ${env:resourceGroup} -DataFactoryName ${env:factoryName} -TriggerName $i -Force
    }
	
#Remove triggers prior to the ADF ARM deployment to stop unwanted errors when re-deploying tumbling window schedule
 $list1 =  Get-AzDataFactoryV2Trigger -ResourceGroupName ${env:resourceGroup} -DataFactoryName ${env:factoryName} | Select-Object -ExpandProperty Name
 $array1 = @($list)
    Foreach ($i in $array1)

    {
    Write-Output "Trigger to disable & remove is $i"
	Remove-AzDataFactoryV2Trigger -ResourceGroupName ${env:resourceGroup} -DataFactoryName ${env:factoryName} -TriggerName $i -Force
    }
	
#Add Lock back on Storage and ADF resourceGroup
New-AzResourceLock -LockName CCMLock -LockLevel CanNotDelete -ResourceGroupName ${env:storageresourceGroup} -force
New-AzResourceLock -LockName CCMLock -LockLevel CanNotDelete -ResourceGroupName ${env:resourceGroup} -force
