CREATE TYPE [dbo].[CustomerIdsTableType] AS TABLE(
    [CustomerId] [bigint] NOT NULL PRIMARY KEY
);
GO

CREATE PROCEDURE [dbo].[usp_CustomerAddress_UpdateCustomerGroupId]
    @CustomerIds [dbo].[CustomerIdsTableType] READONLY
AS
BEGIN
    SET NOCOUNT ON;

    BEGIN TRANSACTION;

    BEGIN TRY
        UPDATE ca
        SET ca.customergroupid = c.customergroupid
        FROM dbo.CustomerAddress ca
        INNER JOIN dbo.Customer c ON ca.customerid = c.customerid
        INNER JOIN @CustomerIds cid ON ca.customerid = cid.CustomerId;

        COMMIT TRANSACTION;
    END TRY
    BEGIN CATCH
        ROLLBACK TRANSACTION;

        -- Optional: Throw the error so the caller knows what went wrong
        THROW;
    END CATCH
END;
GO
