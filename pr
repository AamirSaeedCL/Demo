IF OBJECT_ID('tempdb..#temp_K_Blaze_Eligibility') IS NOT NULL
    DROP TABLE #temp_K_Blaze_Eligibility;

CREATE TABLE #temp_K_Blaze_Eligibility (
    AccountID INT,
    LegacyId VARCHAR(40),
    CustomerGroupId UNIQUEIDENTIFIER,
    LitigationMentioned INT,
    Reconnect INT,
    UpsertDateTime DATETIME
);

INSERT INTO #temp_K_Blaze_Eligibility (AccountID, LegacyId, CustomerGroupId, LitigationMentioned, Reconnect, UpsertDateTime)
    SELECT 
        [AccountID],
        [Debtorno] AS LegacyId,
        CAST(NULL AS UNIQUEIDENTIFIER) AS CustomerGroupId,
        [LitMention] AS LitigationMentioned,
        [Reconnect],
        CAST(GETDATE() AS DATETIME) AS UpsertDateTime
    FROM [crs5_oltp_replicated].[CCM].[K_Blaze_Eligibility];  

SELECT DISTINCT 
    AccountID, 
    LegacyId, 
    MAX(LitigationMentioned) AS LitigationMentioned, 
    MAX(Reconnect) AS Reconnect,
    MAX(CustomerGroupId) AS CustomerGroupId, 
    MAX(UpsertDateTime) AS UpsertDateTime
FROM 
    #temp_K_Blaze_Eligibility
GROUP BY 
    AccountID, LegacyId;

DROP TABLE #temp_K_Blaze_Eligibility;
