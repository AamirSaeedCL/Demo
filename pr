namespace MySitecoreIntegration
{
    public static class TemplateConstants
    {
        public static readonly ID SampleTemplateId = new ID("{11111111-1111-1111-1111-111111111111}");
        public static readonly ID TitleFieldId = new ID("{22222222-2222-2222-2222-222222222222}");
        public static readonly ID DescriptionFieldId = new ID("{33333333-3333-3333-3333-333333333333}");
    }
    public class TemplateItemService
    {
        private readonly Database _database;
        public TemplateItemService(string databaseName = "master")
        {
            _database = Sitecore.Configuration.Factory.GetDatabase(databaseName);
        }

        public Item CreateItem(string parentPath, string itemName, string title, string description)
        {
            Item parentItem = _database.GetItem(parentPath);
            if (parentItem == null)
            {
                throw new InvalidOperationException("Parent item not found.");
            }

            TemplateItem template = _database.GetTemplate(TemplateConstants.SampleTemplateId);

            using (new SecurityDisabler())
            {
                Item newItem = parentItem.Add(itemName, template);
                newItem.Editing.BeginEdit();
                try
                {
                    newItem.Fields[TemplateConstants.TitleFieldId].Value = title;
                    newItem.Fields[TemplateConstants.DescriptionFieldId].Value = description;
                    newItem.Editing.EndEdit();
                }
                catch
                {
                    newItem.Editing.CancelEdit();
                    throw;
                }
                return newItem;
            }
        }

        public Item GetItemById(string itemId)
        {
            return _database.GetItem(new ID(itemId));
        }

        public void UpdateItem(Item item, string title, string description)
        {
            using (new SecurityDisabler())
            {
                item.Editing.BeginEdit();
                try
                {
                    item.Fields[TemplateConstants.TitleFieldId].Value = title;
                    item.Fields[TemplateConstants.DescriptionFieldId].Value = description;
                    item.Editing.EndEdit();
                }
                catch
                {
                    item.Editing.CancelEdit();
                    throw;
                }
            }
        }
    }
}
