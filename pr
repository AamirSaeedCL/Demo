CREATE PROCEDURE [dbo].[usp_Customer_Initial_Ingestion_UpdateCustomerIsValidMobile]
    @MobileData [dbo].[CustomerIsValidMobileTableType] READONLY,
    @IsValidMobileData [dbo].[CustomerIsValidMobileTableType] READONLY
AS
BEGIN
    SET NOCOUNT ON;
    
    -- Reset the status to de-active/zero for all the existing rows
    UPDATE c
    SET 
        c.IsValidMobile = 0 
    FROM dbo.Customer c
    INNER JOIN @MobileData m ON c.CustomerId = m.CustomerId

    -- Set the status to active for ONLY valid rows.
    UPDATE c
    SET 
        c.IsValidMobile = 1
    FROM dbo.Customer c
    INNER JOIN @IsValidMobileData m ON c.CustomerId = m.CustomerId
    
    -- Return number of updated rows
    RETURN @@ROWCOUNT;
END;
