SELECT
    fc.cnsmr_id           AS CustomerId,
    t.tag_shrt_nm         AS TagValue,
    fc.cnsmr_tag_assgn_dt AS TagAssignedDate,
    CASE
        WHEN fc.cnsmr_tag_sft_delete_flg = 'Y'
        THEN fc.upsrt_dttm
    END                   AS TagRemovedDate,
    CASE
        WHEN fc.cnsmr_tag_sft_delete_flg = 'Y' THEN CAST(0 AS bit)
        ELSE CAST(1 AS bit)
    END                   AS TagActive,
    fc.upsrt_dttm         AS UpsertDateTime
FROM FilteredTagChange fc
JOIN dbo.tag t
    ON t.tag_id = fc.tag_id
   AND t.tag_typ_id = @TagTypeId;
