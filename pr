
BEGIN TRY
    BEGIN TRANSACTION;

    UPDATE c
    SET c.CustomerGroupId = cg.GroupId
    FROM dbo.Customer c
    INNER JOIN dbo.ConsumerGroup cg
        ON cg.ConsumerId = c.CustomerId
    WHERE cg.GroupId <> c.CustomerGroupId;

    COMMIT TRANSACTION;
END TRY
BEGIN CATCH
    ROLLBACK TRANSACTION;

    -- Optional: Raise the error so it can be handled by calling code
    THROW;
END CATCH
