CREATE PROCEDURE [dbo].[usp_PaymentPlan_UpdateCustomerGroupId]
AS
BEGIN
    SET NOCOUNT ON;
    SET XACT_ABORT ON;

    BEGIN TRANSACTION;

    UPDATE pp
    SET pp.CustomerGroupId = c.CustomerGroupId
    FROM dbo.PaymentPlan pp
    INNER JOIN dbo.Customer c ON pp.CustomerId = c.CustomerId
    WHERE pp.CustomerGroupId IS NULL OR pp.CustomerGroupId <> c.CustomerGroupId;

    COMMIT TRANSACTION;
END;
GO


WITH (TABLOCKX, UPDLOCK, HOLDLOCK)
